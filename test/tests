#!/usr/bin/env bash

source "$( pwd )/test/utils"
source "$( pwd )/test/helpers"

test::detect_legacy_default() {
    # Test the buildpack detect script with a single simple .php file
    test::helpers::detect "legacy_default"
    assertCapturedSuccess
    assertCapturedEquals "PHP (classic)"
}

test::compile_legacy_default() {
    # Test the buildpack compile script with a single simple .php file
    test::helpers::compile "legacy_default"
    assertCapturedSuccess
}

test::detect_composer_default() {
    test::helpers::detect "composer_default"
    assertCapturedSuccess
    assertCapturedEquals "PHP (composer.json)"
}

test::compile_composer_default() {
    test::helpers::compile "composer_default"
    # We can't use assertCapturedSuccess here:
    # Even with an empty composer.json file, composer will use stderr to warn
    # us that nothing had to be installed -_-, causing the test to fail for no
    # reason.
    assertSuccess
}

# Add these functions to the test suite:

suite_addTest test::detect_legacy_default
suite_addTest test::compile_legacy_default
suite_addTest test::detect_composer_default
suite_addTest test::compile_composer_default
